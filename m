Return-Path: <linux-scsi-owner@vger.kernel.org>
X-Original-To: lists+linux-scsi@lfdr.de
Delivered-To: lists+linux-scsi@lfdr.de
Received: from vger.kernel.org (vger.kernel.org [23.128.96.18])
	by mail.lfdr.de (Postfix) with ESMTP id 6E1411C2BC7
	for <lists+linux-scsi@lfdr.de>; Sun,  3 May 2020 13:35:00 +0200 (CEST)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S1728298AbgECLeg (ORCPT <rfc822;lists+linux-scsi@lfdr.de>);
        Sun, 3 May 2020 07:34:36 -0400
Received: from mailgw01.mediatek.com ([210.61.82.183]:8374 "EHLO
        mailgw01.mediatek.com" rhost-flags-OK-FAIL-OK-FAIL) by vger.kernel.org
        with ESMTP id S1727773AbgECLea (ORCPT
        <rfc822;linux-scsi@vger.kernel.org>); Sun, 3 May 2020 07:34:30 -0400
X-UUID: 03c8f673dc9d4717b58c03b466303e1c-20200503
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed; d=mediatek.com; s=dk;
        h=Content-Transfer-Encoding:Content-Type:MIME-Version:References:In-Reply-To:Message-ID:Date:Subject:CC:To:From; bh=43njin1vrQcshqccPuO6P0B782ptgqsgZdx0R2qdBjo=;
        b=JMj08QqAGS4hlzrSo7cKD6+GTSLHy15CHAHtHm6sUVZTGXSmIGyY99px8/e2kIuHCEd+2/I5SPZt2C2acP+hiCf/k3RNwTX0P1lEX3S3BRr1lrZU3SRBc32rwcBA1Lp8VUt6Cwi4dMhroTQgP4bsAzTIpaGP5g6M9FsmvYp77zE=;
X-UUID: 03c8f673dc9d4717b58c03b466303e1c-20200503
Received: from mtkexhb02.mediatek.inc [(172.21.101.103)] by mailgw01.mediatek.com
        (envelope-from <stanley.chu@mediatek.com>)
        (Cellopoint E-mail Firewall v4.1.10 Build 0809 with TLS)
        with ESMTP id 548597131; Sun, 03 May 2020 19:34:25 +0800
Received: from mtkcas08.mediatek.inc (172.21.101.126) by
 mtkmbs02n1.mediatek.inc (172.21.101.77) with Microsoft SMTP Server (TLS) id
 15.0.1497.2; Sun, 3 May 2020 19:34:17 +0800
Received: from mtksdccf07.mediatek.inc (172.21.84.99) by mtkcas08.mediatek.inc
 (172.21.101.73) with Microsoft SMTP Server id 15.0.1497.2 via Frontend
 Transport; Sun, 3 May 2020 19:34:16 +0800
From:   Stanley Chu <stanley.chu@mediatek.com>
To:     <linux-scsi@vger.kernel.org>, <martin.petersen@oracle.com>,
        <avri.altman@wdc.com>, <alim.akhtar@samsung.com>,
        <jejb@linux.ibm.com>, <asutoshd@codeaurora.org>
CC:     <beanhuo@micron.com>, <cang@codeaurora.org>,
        <matthias.bgg@gmail.com>, <bvanassche@acm.org>,
        <linux-mediatek@lists.infradead.org>,
        <linux-arm-kernel@lists.infradead.org>,
        <linux-kernel@vger.kernel.org>, <kuohong.wang@mediatek.com>,
        <peter.wang@mediatek.com>, <chun-hung.wu@mediatek.com>,
        <andy.teng@mediatek.com>, Stanley Chu <stanley.chu@mediatek.com>
Subject: [PATCH v5 6/8] scsi: ufs: add LU Dedicated buffer mode support for WriteBooster
Date:   Sun, 3 May 2020 19:34:13 +0800
Message-ID: <20200503113415.21034-7-stanley.chu@mediatek.com>
X-Mailer: git-send-email 2.18.0
In-Reply-To: <20200503113415.21034-1-stanley.chu@mediatek.com>
References: <20200503113415.21034-1-stanley.chu@mediatek.com>
MIME-Version: 1.0
Content-Type: text/plain
X-MTK:  N
Content-Transfer-Encoding: base64
Sender: linux-scsi-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-scsi.vger.kernel.org>
X-Mailing-List: linux-scsi@vger.kernel.org

QWNjb3JkaW5nIHRvIFVGUyBzcGVjaWZpY2F0aW9uLCB0aGVyZSBhcmUgdHdvIFdyaXRlQm9vc3Rl
ciBtb2RlIG9mDQpvcGVyYXRpb25zOiAiTFUgZGVkaWNhdGVkIGJ1ZmZlciIgbW9kZSBhbmQgInNo
YXJlZCBidWZmZXIiIG1vZGUuDQpJbiB0aGUgIkxVIGRlZGljYXRlZCBidWZmZXIiIG1vZGUsIHRo
ZSBXcml0ZUJvb3N0ZXIgQnVmZmVyIGlzDQpkZWRpY2F0ZWQgdG8gYSBsb2dpY2FsIHVuaXQuDQoN
CklmIHRoZSBkZXZpY2Ugc3VwcG9ydHMgdGhlICJMVSBkZWRpY2F0ZWQgYnVmZmVyIiBtb2RlLCB0
aGlzIG1vZGUgaXMNCmNvbmZpZ3VyZWQgYnkgc2V0dGluZyBiV3JpdGVCb29zdGVyQnVmZmVyVHlw
ZSB0byAwMGguIFRoZSBsb2dpY2FsDQp1bml0IFdyaXRlQm9vc3RlciBCdWZmZXIgc2l6ZSBpcyBj
b25maWd1cmVkIGJ5IHNldHRpbmcgdGhlDQpkTFVOdW1Xcml0ZUJvb3N0ZXJCdWZmZXJBbGxvY1Vu
aXRzIGZpZWxkIG9mIHRoZSByZWxhdGVkIFVuaXQNCkRlc2NyaXB0b3IuIE9ubHkgYSB2YWx1ZSBn
cmVhdGVyIHRoYW4gemVybyBlbmFibGVzIHRoZSBXcml0ZUJvb3N0ZXINCmZlYXR1cmUgaW4gdGhl
IGxvZ2ljYWwgdW5pdC4NCg0KTW9kaWZ5IHVmc2hjZF93Yl9wcm9iZSgpIGFzIGFib3ZlIGRlc2Ny
aXB0aW9uIHRvIHN1cHBvcnQgTFUgRGVkaWNhdGVkDQpidWZmZXIgbW9kZS4NCg0KTm90ZSB0aGF0
IGFjY29yZGluZyB0byBVRlMgMy4xIHNwZWNpZmljYXRpb24sIHRoZSB2YWxpZCB2YWx1ZSBvZg0K
YkRldmljZU1heFdyaXRlQm9vc3RlckxVcyBwYXJhbWV0ZXIgaW4gR2VvbWV0cnkgRGVzY3JpcHRv
ciBpcyAxLA0Kd2hpY2ggbWVhbnMgYXQgbW9zdCBvbmUgTFVOIGNhbiBoYXZlIFdyaXRlQm9vc3Rl
ciBidWZmZXIgaW4gIkxVDQpkZWRpY2F0ZWQgYnVmZmVyIG1vZGUiLiBUaGVyZWZvcmUgdGhpcyBw
YXRjaCBzdXBwb3J0cyBvbmx5IG9uZQ0KTFVOIHdpdGggV3JpdGVCb29zdGVyIGVuYWJsZWQuIEFs
bCBXcml0ZUJvb3N0ZXIgcmVsYXRlZCBzeXNmcyBub2Rlcw0KYXJlIHNwZWNpZmljYWxseSBtYXBw
ZWQgdG8gdGhlIExVTiB3aXRoIFdyaXRlQm9vc3RlciBlbmFibGVkIGluDQpMVSBEZWRpY2F0ZWQg
YnVmZmVyIG1vZGUuDQoNClNpZ25lZC1vZmYtYnk6IFN0YW5sZXkgQ2h1IDxzdGFubGV5LmNodUBt
ZWRpYXRlay5jb20+DQotLS0NCiBkcml2ZXJzL3Njc2kvdWZzL3Vmcy1zeXNmcy5jIHwgMTEgKysr
KysrKy0NCiBkcml2ZXJzL3Njc2kvdWZzL3Vmcy5oICAgICAgIHwgMTAgKysrKysrKw0KIGRyaXZl
cnMvc2NzaS91ZnMvdWZzaGNkLmMgICAgfCA1MSArKysrKysrKysrKysrKysrKysrKysrKysrKysr
LS0tLS0tLS0NCiBkcml2ZXJzL3Njc2kvdWZzL3Vmc2hjZC5oICAgIHwgIDcgKysrKysNCiA0IGZp
bGVzIGNoYW5nZWQsIDY3IGluc2VydGlvbnMoKyksIDEyIGRlbGV0aW9ucygtKQ0KDQpkaWZmIC0t
Z2l0IGEvZHJpdmVycy9zY3NpL3Vmcy91ZnMtc3lzZnMuYyBiL2RyaXZlcnMvc2NzaS91ZnMvdWZz
LXN5c2ZzLmMNCmluZGV4IGI4NmI2YTQwZDdlNi4uYTBiMzc2M2UxZGMyIDEwMDY0NA0KLS0tIGEv
ZHJpdmVycy9zY3NpL3Vmcy91ZnMtc3lzZnMuYw0KKysrIGIvZHJpdmVycy9zY3NpL3Vmcy91ZnMt
c3lzZnMuYw0KQEAgLTYyMiwxNiArNjIyLDI1IEBAIHN0YXRpYyBjb25zdCBzdHJ1Y3QgYXR0cmli
dXRlX2dyb3VwIHVmc19zeXNmc19zdHJpbmdfZGVzY3JpcHRvcnNfZ3JvdXAgPSB7DQogCS5hdHRy
cyA9IHVmc19zeXNmc19zdHJpbmdfZGVzY3JpcHRvcnMsDQogfTsNCiANCitzdGF0aWMgaW5saW5l
IGJvb2wgdWZzaGNkX2lzX3diX2ZsYWdzKGVudW0gZmxhZ19pZG4gaWRuKQ0KK3sNCisJcmV0dXJu
ICgoaWRuID49IFFVRVJZX0ZMQUdfSUROX1dCX0VOKSAmJg0KKwkJKGlkbiA8PSBRVUVSWV9GTEFH
X0lETl9XQl9CVUZGX0ZMVVNIX0RVUklOR19ISUJFUk44KSk7DQorfQ0KKw0KICNkZWZpbmUgVUZT
X0ZMQUcoX25hbWUsIF91bmFtZSkJCQkJCQlcDQogc3RhdGljIHNzaXplX3QgX25hbWUjI19zaG93
KHN0cnVjdCBkZXZpY2UgKmRldiwJCQkJXA0KIAlzdHJ1Y3QgZGV2aWNlX2F0dHJpYnV0ZSAqYXR0
ciwgY2hhciAqYnVmKQkJCVwNCiB7CQkJCQkJCQkJXA0KIAlib29sIGZsYWc7CQkJCQkJCVwNCisJ
dTggaW5kZXggPSAwOwkJCQkJCQlcDQogCWludCByZXQ7CQkJCQkJCVwNCiAJc3RydWN0IHVmc19o
YmEgKmhiYSA9IGRldl9nZXRfZHJ2ZGF0YShkZXYpOwkJCVwNCisJaWYgKHVmc2hjZF9pc193Yl9m
bGFncyhRVUVSWV9GTEFHX0lETiMjX3VuYW1lKSkJCQlcDQorCQlpbmRleCA9IHVmc2hjZF93Yl9n
ZXRfZmxhZ19pbmRleChoYmEpOwkJCVwNCiAJcG1fcnVudGltZV9nZXRfc3luYyhoYmEtPmRldik7
CQkJCQlcDQogCXJldCA9IHVmc2hjZF9xdWVyeV9mbGFnKGhiYSwgVVBJVV9RVUVSWV9PUENPREVf
UkVBRF9GTEFHLAlcDQotCQlRVUVSWV9GTEFHX0lETiMjX3VuYW1lLCAwLCAmZmxhZyk7CQkJXA0K
KwkJUVVFUllfRkxBR19JRE4jI191bmFtZSwgaW5kZXgsICZmbGFnKTsJCQlcDQogCXBtX3J1bnRp
bWVfcHV0X3N5bmMoaGJhLT5kZXYpOwkJCQkJXA0KIAlpZiAocmV0KQkJCQkJCQlcDQogCQlyZXR1
cm4gLUVJTlZBTDsJCQkJCQlcDQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9zY3NpL3Vmcy91ZnMuaCBi
L2RyaXZlcnMvc2NzaS91ZnMvdWZzLmgNCmluZGV4IGRhYWM1MDUzYjg1MC4uYjMxMzUzNDRhYjNm
IDEwMDY0NA0KLS0tIGEvZHJpdmVycy9zY3NpL3Vmcy91ZnMuaA0KKysrIGIvZHJpdmVycy9zY3Np
L3Vmcy91ZnMuaA0KQEAgLTY0LDYgKzY0LDkgQEANCiAjZGVmaW5lIFVGU19NQVhfTFVOUwkJKFND
U0lfV19MVU5fQkFTRSArIFVGU19VUElVX01BWF9VTklUX05VTV9JRCkNCiAjZGVmaW5lIFVGU19V
UElVX1dMVU5fSUQJKDEgPDwgNykNCiANCisvKiBXcml0ZUJvb3N0ZXIgYnVmZmVyIGlzIGF2YWls
YWJsZSBvbmx5IGZvciB0aGUgbG9naWNhbCB1bml0IGZyb20gMCB0byA3ICovDQorI2RlZmluZSBV
RlNfVVBJVV9NQVhfV0JfTFVOX0lECTgNCisNCiAvKiBXZWxsIGtub3duIGxvZ2ljYWwgdW5pdCBp
ZCBpbiBMVU4gZmllbGQgb2YgVVBJVSAqLw0KIGVudW0gew0KIAlVRlNfVVBJVV9SRVBPUlRfTFVO
U19XTFVOCT0gMHg4MSwNCkBAIC0zMzAsNiArMzMzLDEyIEBAIGVudW0gaGVhbHRoX2Rlc2NfcGFy
YW0gew0KIAlIRUFMVEhfREVTQ19QQVJBTV9MSUZFX1RJTUVfRVNUX0IJPSAweDQsDQogfTsNCiAN
CisvKiBXcml0ZUJvb3N0ZXIgYnVmZmVyIG1vZGUgKi8NCitlbnVtIHsNCisJV0JfQlVGX01PREVf
TFVfREVESUNBVEVECT0gMHgwLA0KKwlXQl9CVUZfTU9ERV9TSEFSRUQJCT0gMHgxLA0KK307DQor
DQogLyoNCiAgKiBMb2dpY2FsIFVuaXQgV3JpdGUgUHJvdGVjdA0KICAqIDAwaDogTFUgbm90IHdy
aXRlIHByb3RlY3RlZA0KQEAgLTU1OSw2ICs1NjgsNyBAQCBzdHJ1Y3QgdWZzX2Rldl9pbmZvIHsN
CiAJYm9vbCBpc19sdV9wb3dlcl9vbl93cDsNCiAJLyogTWF4aW11bSBudW1iZXIgb2YgZ2VuZXJh
bCBMVSBzdXBwb3J0ZWQgYnkgdGhlIFVGUyBkZXZpY2UgKi8NCiAJdTggbWF4X2x1X3N1cHBvcnRl
ZDsNCisJdTggd2JfZGVkaWNhdGVkX2x1Ow0KIAl1MTYgd21hbnVmYWN0dXJlcmlkOw0KIAkvKlVG
UyBkZXZpY2UgUHJvZHVjdCBOYW1lICovDQogCXU4ICptb2RlbDsNCmRpZmYgLS1naXQgYS9kcml2
ZXJzL3Njc2kvdWZzL3Vmc2hjZC5jIGIvZHJpdmVycy9zY3NpL3Vmcy91ZnNoY2QuYw0KaW5kZXgg
ZDRhOWM0NzkyOTRjLi40OTM5MWJjMWVmMjEgMTAwNjQ0DQotLS0gYS9kcml2ZXJzL3Njc2kvdWZz
L3Vmc2hjZC5jDQorKysgYi9kcml2ZXJzL3Njc2kvdWZzL3Vmc2hjZC5jDQpAQCAtNTIwNSw2ICs1
MjA1LDcgQEAgc3RhdGljIGJvb2wgdWZzaGNkX3diX3N1cChzdHJ1Y3QgdWZzX2hiYSAqaGJhKQ0K
IHN0YXRpYyBpbnQgdWZzaGNkX3diX2N0cmwoc3RydWN0IHVmc19oYmEgKmhiYSwgYm9vbCBlbmFi
bGUpDQogew0KIAlpbnQgcmV0Ow0KKwl1OCBpbmRleDsNCiAJZW51bSBxdWVyeV9vcGNvZGUgb3Bj
b2RlOw0KIA0KIAlpZiAoIXVmc2hjZF93Yl9zdXAoaGJhKSkNCkBAIC01MjE3LDggKzUyMTgsOSBA
QCBzdGF0aWMgaW50IHVmc2hjZF93Yl9jdHJsKHN0cnVjdCB1ZnNfaGJhICpoYmEsIGJvb2wgZW5h
YmxlKQ0KIAllbHNlDQogCQlvcGNvZGUgPSBVUElVX1FVRVJZX09QQ09ERV9DTEVBUl9GTEFHOw0K
IA0KKwlpbmRleCA9IHVmc2hjZF93Yl9nZXRfZmxhZ19pbmRleChoYmEpOw0KIAlyZXQgPSB1ZnNo
Y2RfcXVlcnlfZmxhZ19yZXRyeShoYmEsIG9wY29kZSwNCi0JCQkJICAgICAgUVVFUllfRkxBR19J
RE5fV0JfRU4sIDAsIE5VTEwpOw0KKwkJCQkgICAgICBRVUVSWV9GTEFHX0lETl9XQl9FTiwgaW5k
ZXgsIE5VTEwpOw0KIAlpZiAocmV0KSB7DQogCQlkZXZfZXJyKGhiYS0+ZGV2LCAiJXMgd3JpdGUg
Ym9vc3RlciAlcyBmYWlsZWQgJWRcbiIsDQogCQkJX19mdW5jX18sIGVuYWJsZSA/ICJlbmFibGUi
IDogImRpc2FibGUiLCByZXQpOw0KQEAgLTUyMzUsMTUgKzUyMzcsMTcgQEAgc3RhdGljIGludCB1
ZnNoY2Rfd2JfY3RybChzdHJ1Y3QgdWZzX2hiYSAqaGJhLCBib29sIGVuYWJsZSkNCiBzdGF0aWMg
aW50IHVmc2hjZF93Yl90b2dnbGVfZmx1c2hfZHVyaW5nX2g4KHN0cnVjdCB1ZnNfaGJhICpoYmEs
IGJvb2wgc2V0KQ0KIHsNCiAJaW50IHZhbDsNCisJdTggaW5kZXg7DQogDQogCWlmIChzZXQpDQog
CQl2YWwgPSAgVVBJVV9RVUVSWV9PUENPREVfU0VUX0ZMQUc7DQogCWVsc2UNCiAJCXZhbCA9IFVQ
SVVfUVVFUllfT1BDT0RFX0NMRUFSX0ZMQUc7DQogDQorCWluZGV4ID0gdWZzaGNkX3diX2dldF9m
bGFnX2luZGV4KGhiYSk7DQogCXJldHVybiB1ZnNoY2RfcXVlcnlfZmxhZ19yZXRyeShoYmEsIHZh
bCwNCi0JCQkgICAgICAgUVVFUllfRkxBR19JRE5fV0JfQlVGRl9GTFVTSF9EVVJJTkdfSElCRVJO
OCwgMCwNCi0JCQkJICAgICAgIE5VTEwpOw0KKwkJCQlRVUVSWV9GTEFHX0lETl9XQl9CVUZGX0ZM
VVNIX0RVUklOR19ISUJFUk44LA0KKwkJCQlpbmRleCwgTlVMTCk7DQogfQ0KIA0KIHN0YXRpYyBp
bmxpbmUgdm9pZCB1ZnNoY2Rfd2JfdG9nZ2xlX2ZsdXNoKHN0cnVjdCB1ZnNfaGJhICpoYmEsIGJv
b2wgZW5hYmxlKQ0KQEAgLTUyNTgsMTMgKzUyNjIsMTUgQEAgc3RhdGljIGlubGluZSB2b2lkIHVm
c2hjZF93Yl90b2dnbGVfZmx1c2goc3RydWN0IHVmc19oYmEgKmhiYSwgYm9vbCBlbmFibGUpDQog
c3RhdGljIGludCB1ZnNoY2Rfd2JfYnVmX2ZsdXNoX2VuYWJsZShzdHJ1Y3QgdWZzX2hiYSAqaGJh
KQ0KIHsNCiAJaW50IHJldDsNCisJdTggaW5kZXg7DQogDQogCWlmICghdWZzaGNkX3diX3N1cCho
YmEpIHx8IGhiYS0+d2JfYnVmX2ZsdXNoX2VuYWJsZWQpDQogCQlyZXR1cm4gMDsNCiANCisJaW5k
ZXggPSB1ZnNoY2Rfd2JfZ2V0X2ZsYWdfaW5kZXgoaGJhKTsNCiAJcmV0ID0gdWZzaGNkX3F1ZXJ5
X2ZsYWdfcmV0cnkoaGJhLCBVUElVX1FVRVJZX09QQ09ERV9TRVRfRkxBRywNCiAJCQkJICAgICAg
UVVFUllfRkxBR19JRE5fV0JfQlVGRl9GTFVTSF9FTiwNCi0JCQkJICAgICAgMCwgTlVMTCk7DQor
CQkJCSAgICAgIGluZGV4LCBOVUxMKTsNCiAJaWYgKHJldCkNCiAJCWRldl9lcnIoaGJhLT5kZXYs
ICIlcyBXQiAtIGJ1ZiBmbHVzaCBlbmFibGUgZmFpbGVkICVkXG4iLA0KIAkJCV9fZnVuY19fLCBy
ZXQpOw0KQEAgLTUyNzgsMTIgKzUyODQsMTUgQEAgc3RhdGljIGludCB1ZnNoY2Rfd2JfYnVmX2Zs
dXNoX2VuYWJsZShzdHJ1Y3QgdWZzX2hiYSAqaGJhKQ0KIHN0YXRpYyBpbnQgdWZzaGNkX3diX2J1
Zl9mbHVzaF9kaXNhYmxlKHN0cnVjdCB1ZnNfaGJhICpoYmEpDQogew0KIAlpbnQgcmV0Ow0KKwl1
OCBpbmRleDsNCiANCiAJaWYgKCF1ZnNoY2Rfd2Jfc3VwKGhiYSkgfHwgIWhiYS0+d2JfYnVmX2Zs
dXNoX2VuYWJsZWQpDQogCQlyZXR1cm4gMDsNCiANCisJaW5kZXggPSB1ZnNoY2Rfd2JfZ2V0X2Zs
YWdfaW5kZXgoaGJhKTsNCiAJcmV0ID0gdWZzaGNkX3F1ZXJ5X2ZsYWdfcmV0cnkoaGJhLCBVUElV
X1FVRVJZX09QQ09ERV9DTEVBUl9GTEFHLA0KLQkJCQkgICAgICBRVUVSWV9GTEFHX0lETl9XQl9C
VUZGX0ZMVVNIX0VOLCAwLCBOVUxMKTsNCisJCQkJICAgICAgUVVFUllfRkxBR19JRE5fV0JfQlVG
Rl9GTFVTSF9FTiwNCisJCQkJICAgICAgaW5kZXgsIE5VTEwpOw0KIAlpZiAocmV0KSB7DQogCQlk
ZXZfd2FybihoYmEtPmRldiwgIiVzOiBXQiAtIGJ1ZiBmbHVzaCBkaXNhYmxlIGZhaWxlZCAlZFxu
IiwNCiAJCQkgX19mdW5jX18sIHJldCk7DQpAQCAtNjgwMiw2ICs2ODExLDEwIEBAIHN0YXRpYyBp
bnQgdWZzaGNkX3Njc2lfYWRkX3dsdXMoc3RydWN0IHVmc19oYmEgKmhiYSkNCiANCiBzdGF0aWMg
dm9pZCB1ZnNoY2Rfd2JfcHJvYmUoc3RydWN0IHVmc19oYmEgKmhiYSwgdTggKmRlc2NfYnVmKQ0K
IHsNCisJaW50IHJldDsNCisJdTggbHVuOw0KKwl1MzIgZF9sdV93Yl9idWZfYWxsb2M7DQorDQog
CWlmICghdWZzaGNkX2lzX3diX2FsbG93ZWQoaGJhKSkNCiAJCXJldHVybjsNCiANCkBAIC02ODI0
LDE2ICs2ODM3LDMyIEBAIHN0YXRpYyB2b2lkIHVmc2hjZF93Yl9wcm9iZShzdHJ1Y3QgdWZzX2hi
YSAqaGJhLCB1OCAqZGVzY19idWYpDQogCWhiYS0+ZGV2X2luZm8uYl93Yl9idWZmZXJfdHlwZSA9
DQogCQlkZXNjX2J1ZltERVZJQ0VfREVTQ19QQVJBTV9XQl9UWVBFXTsNCiANCi0JaGJhLT5kZXZf
aW5mby5kX3diX2FsbG9jX3VuaXRzID0NCi0JCWdldF91bmFsaWduZWRfYmUzMihkZXNjX2J1ZiAr
DQotCQkJCSAgIERFVklDRV9ERVNDX1BBUkFNX1dCX1NIQVJFRF9BTExPQ19VTklUUyk7DQogCWhi
YS0+ZGV2X2luZm8uYl9wcmVzcnZfdXNwY19lbiA9DQogCQlkZXNjX2J1ZltERVZJQ0VfREVTQ19Q
QVJBTV9XQl9QUkVTUlZfVVNSU1BDX0VOXTsNCiANCi0JaWYgKCEoaGJhLT5kZXZfaW5mby5iX3di
X2J1ZmZlcl90eXBlICYmDQotCSAgICAgIGhiYS0+ZGV2X2luZm8uZF93Yl9hbGxvY191bml0cykp
DQotCQlnb3RvIHdiX2Rpc2FibGVkOw0KKwlpZiAoaGJhLT5kZXZfaW5mby5iX3diX2J1ZmZlcl90
eXBlID09IFdCX0JVRl9NT0RFX1NIQVJFRCkgew0KKwkJaGJhLT5kZXZfaW5mby5kX3diX2FsbG9j
X3VuaXRzID0NCisJCWdldF91bmFsaWduZWRfYmUzMihkZXNjX2J1ZiArDQorCQkJCSAgIERFVklD
RV9ERVNDX1BBUkFNX1dCX1NIQVJFRF9BTExPQ19VTklUUyk7DQorCQlpZiAoIWhiYS0+ZGV2X2lu
Zm8uZF93Yl9hbGxvY191bml0cykNCisJCQlnb3RvIHdiX2Rpc2FibGVkOw0KKwl9IGVsc2Ugew0K
KwkJZm9yIChsdW4gPSAwOyBsdW4gPCBVRlNfVVBJVV9NQVhfV0JfTFVOX0lEOyBsdW4rKykgew0K
KwkJCWRfbHVfd2JfYnVmX2FsbG9jID0gMDsNCisJCQl1ZnNoY2RfcmVhZF91bml0X2Rlc2NfcGFy
YW0oaGJhLA0KKwkJCQkJbHVuLA0KKwkJCQkJVU5JVF9ERVNDX1BBUkFNX1dCX0JVRl9BTExPQ19V
TklUUywNCisJCQkJCSh1OCAqKSZkX2x1X3diX2J1Zl9hbGxvYywNCisJCQkJCXNpemVvZihkX2x1
X3diX2J1Zl9hbGxvYykpOw0KKwkJCWlmIChkX2x1X3diX2J1Zl9hbGxvYykgew0KKwkJCQloYmEt
PmRldl9pbmZvLndiX2RlZGljYXRlZF9sdSA9IGx1bjsNCisJCQkJYnJlYWs7DQorCQkJfQ0KKwkJ
fQ0KIA0KKwkJaWYgKCFkX2x1X3diX2J1Zl9hbGxvYykNCisJCQlnb3RvIHdiX2Rpc2FibGVkOw0K
Kwl9DQogCXJldHVybjsNCiANCiB3Yl9kaXNhYmxlZDoNCmRpZmYgLS1naXQgYS9kcml2ZXJzL3Nj
c2kvdWZzL3Vmc2hjZC5oIGIvZHJpdmVycy9zY3NpL3Vmcy91ZnNoY2QuaA0KaW5kZXggODk4ODgz
MDU4ZTNhLi5mMjMyYTY3ZmQ5YjMgMTAwNjQ0DQotLS0gYS9kcml2ZXJzL3Njc2kvdWZzL3Vmc2hj
ZC5oDQorKysgYi9kcml2ZXJzL3Njc2kvdWZzL3Vmc2hjZC5oDQpAQCAtODYxLDYgKzg2MSwxMyBA
QCBzdGF0aWMgaW5saW5lIGJvb2wgdWZzaGNkX2tlZXBfYXV0b2Jrb3BzX2VuYWJsZWRfZXhjZXB0
X3N1c3BlbmQoDQogCXJldHVybiBoYmEtPmNhcHMgJiBVRlNIQ0RfQ0FQX0tFRVBfQVVUT19CS09Q
U19FTkFCTEVEX0VYQ0VQVF9TVVNQRU5EOw0KIH0NCiANCitzdGF0aWMgaW5saW5lIHU4IHVmc2hj
ZF93Yl9nZXRfZmxhZ19pbmRleChzdHJ1Y3QgdWZzX2hiYSAqaGJhKQ0KK3sNCisJaWYgKGhiYS0+
ZGV2X2luZm8uYl93Yl9idWZmZXJfdHlwZSA9PSBXQl9CVUZfTU9ERV9MVV9ERURJQ0FURUQpDQor
CQlyZXR1cm4gaGJhLT5kZXZfaW5mby53Yl9kZWRpY2F0ZWRfbHU7DQorCXJldHVybiAwOw0KK30N
CisNCiBleHRlcm4gaW50IHVmc2hjZF9ydW50aW1lX3N1c3BlbmQoc3RydWN0IHVmc19oYmEgKmhi
YSk7DQogZXh0ZXJuIGludCB1ZnNoY2RfcnVudGltZV9yZXN1bWUoc3RydWN0IHVmc19oYmEgKmhi
YSk7DQogZXh0ZXJuIGludCB1ZnNoY2RfcnVudGltZV9pZGxlKHN0cnVjdCB1ZnNfaGJhICpoYmEp
Ow0KLS0gDQoyLjE4LjANCg==

