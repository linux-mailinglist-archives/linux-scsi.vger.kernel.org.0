Return-Path: <linux-scsi-owner@vger.kernel.org>
X-Original-To: lists+linux-scsi@lfdr.de
Delivered-To: lists+linux-scsi@lfdr.de
Received: from vger.kernel.org (vger.kernel.org [23.128.96.18])
	by mail.lfdr.de (Postfix) with ESMTP id 8B2452DA7C8
	for <lists+linux-scsi@lfdr.de>; Tue, 15 Dec 2020 06:44:40 +0100 (CET)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S1726359AbgLOFod (ORCPT <rfc822;lists+linux-scsi@lfdr.de>);
        Tue, 15 Dec 2020 00:44:33 -0500
Received: from mailgw02.mediatek.com ([210.61.82.184]:58385 "EHLO
        mailgw02.mediatek.com" rhost-flags-OK-FAIL-OK-FAIL) by vger.kernel.org
        with ESMTP id S1725889AbgLOFoW (ORCPT
        <rfc822;linux-scsi@vger.kernel.org>); Tue, 15 Dec 2020 00:44:22 -0500
X-UUID: 22a1ba6971754b448c6bddf86184d764-20201215
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed; d=mediatek.com; s=dk;
        h=Content-Transfer-Encoding:MIME-Version:Content-Type:References:In-Reply-To:Date:CC:To:From:Subject:Message-ID; bh=erBQqg/F/LfS/jBrYQvaDd8rg9F1KF/FXw+LXNZwJhw=;
        b=oa4zcLYlOklTWYvDD4CEZi8atQqCaXUKlK75L1cI3U6agwjsEzvlg9kvIAKvN7YdkzYvxbXzjIlc0Qr7yY1V6T/XsjOzJEs9JCS5KER9Py4orLayZ+RAbX+yPdPsFsMahZcd0+a2ifdQzBBmeDoZyHwlQXq2nq8BcZYPEbXue18=;
X-UUID: 22a1ba6971754b448c6bddf86184d764-20201215
Received: from mtkcas10.mediatek.inc [(172.21.101.39)] by mailgw02.mediatek.com
        (envelope-from <stanley.chu@mediatek.com>)
        (Cellopoint E-mail Firewall v4.1.14 Build 0819 with TLSv1.2 ECDHE-RSA-AES256-SHA384 256/256)
        with ESMTP id 1152028715; Tue, 15 Dec 2020 13:43:33 +0800
Received: from MTKCAS06.mediatek.inc (172.21.101.30) by
 mtkmbs07n1.mediatek.inc (172.21.101.16) with Microsoft SMTP Server (TLS) id
 15.0.1497.2; Tue, 15 Dec 2020 13:43:32 +0800
Received: from [172.21.77.33] (172.21.77.33) by MTKCAS06.mediatek.inc
 (172.21.101.73) with Microsoft SMTP Server id 15.0.1497.2 via Frontend
 Transport; Tue, 15 Dec 2020 13:43:32 +0800
Message-ID: <1608011011.10163.9.camel@mtkswgap22>
Subject: Re: [PATCH v4 1/3] scsi: ufs: Protect some contexts from unexpected
 clock scaling
From:   Stanley Chu <stanley.chu@mediatek.com>
To:     Can Guo <cang@codeaurora.org>
CC:     <asutoshd@codeaurora.org>, <nguyenb@codeaurora.org>,
        <hongwus@codeaurora.org>, <rnayak@codeaurora.org>,
        <linux-scsi@vger.kernel.org>, <kernel-team@android.com>,
        <saravanak@google.com>, <salyzyn@google.com>,
        "Alim Akhtar" <alim.akhtar@samsung.com>,
        Avri Altman <avri.altman@wdc.com>,
        "James E.J. Bottomley" <jejb@linux.ibm.com>,
        "Martin K. Petersen" <martin.petersen@oracle.com>,
        Bean Huo <beanhuo@micron.com>,
        "Bart Van Assche" <bvanassche@acm.org>,
        Satya Tangirala <satyat@google.com>,
        open list <linux-kernel@vger.kernel.org>
Date:   Tue, 15 Dec 2020 13:43:31 +0800
In-Reply-To: <1607877104-8916-2-git-send-email-cang@codeaurora.org>
References: <1607877104-8916-1-git-send-email-cang@codeaurora.org>
         <1607877104-8916-2-git-send-email-cang@codeaurora.org>
Content-Type: text/plain; charset="UTF-8"
X-Mailer: Evolution 3.2.3-0ubuntu6 
MIME-Version: 1.0
X-MTK:  N
Content-Transfer-Encoding: base64
Precedence: bulk
List-ID: <linux-scsi.vger.kernel.org>
X-Mailing-List: linux-scsi@vger.kernel.org

SGkgQ2FuLA0KDQpPbiBTdW4sIDIwMjAtMTItMTMgYXQgMDg6MzEgLTA4MDAsIENhbiBHdW8gd3Jv
dGU6DQo+IEluIGNvbnRleHRzIGxpa2Ugc3VzcGVuZCwgc2h1dGRvd24gYW5kIGVycm9yIGhhbmRs
aW5nLCB3ZSBuZWVkIHRvIHN1c3BlbmQNCj4gZGV2ZnJlcSB0byBtYWtlIHN1cmUgdGhlc2UgY29u
dGV4dHMgd29uJ3QgYmUgZGlzdHVyYmVkIGJ5IGNsb2NrIHNjYWxpbmcuDQo+IEhvd2V2ZXIsIHN1
c3BlbmRpbmcgZGV2ZnJlcSBpcyBub3QgZW5vdWdoIHNpbmNlIHVzZXJzIGNhbiBzdGlsbCB0cmln
Z2VyIGENCj4gY2xvY2sgc2NhbGluZyBieSBtYW5pcHVsYXRpbmcgdGhlIHN5c2ZzIG5vZGUgY2xr
c2NhbGVfZW5hYmxlIGFuZCBkZXZmcmVxDQo+IHN5c2ZzIG5vZGVzIGxpa2UgbWluL21heF9mcmVx
IGFuZCBnb3Zlcm5vci4gQWRkIG9uZSBtb3JlIGZsYWcgaW4gc3RydWN0DQo+IGNsa19zY2FsaW5n
IHN1Y2ggdGhhdCB0aGVzZSBjb250ZXh0cyBjYW4gcHJldmVudCBjbG9jayBzY2FsaW5nIGZyb20g
YmVpbmcNCj4gaW52b2tlZCB0aHJvdWdoIGFib3ZlIHN5c2ZzIG5vZGVzLg0KPiANCj4gU2lnbmVk
LW9mZi1ieTogQ2FuIEd1byA8Y2FuZ0Bjb2RlYXVyb3JhLm9yZz4NCj4gLS0tDQo+ICBkcml2ZXJz
L3Njc2kvdWZzL3Vmc2hjZC5jIHwgODMgKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKy0t
LS0tLS0tLS0tLS0tLS0NCj4gIGRyaXZlcnMvc2NzaS91ZnMvdWZzaGNkLmggfCAgMiArKw0KPiAg
MiBmaWxlcyBjaGFuZ2VkLCA1NyBpbnNlcnRpb25zKCspLCAyOCBkZWxldGlvbnMoLSkNCj4gDQo+
IGRpZmYgLS1naXQgYS9kcml2ZXJzL3Njc2kvdWZzL3Vmc2hjZC5jIGIvZHJpdmVycy9zY3NpL3Vm
cy91ZnNoY2QuYw0KPiBpbmRleCAwYzE0OGZjLi40Y2NkZDJiIDEwMDY0NA0KPiAtLS0gYS9kcml2
ZXJzL3Njc2kvdWZzL3Vmc2hjZC5jDQo+ICsrKyBiL2RyaXZlcnMvc2NzaS91ZnMvdWZzaGNkLmMN
Cj4gQEAgLTExNDcsMTIgKzExNDcsMjIgQEAgc3RhdGljIGludCB1ZnNoY2RfY2xvY2tfc2NhbGlu
Z19wcmVwYXJlKHN0cnVjdCB1ZnNfaGJhICpoYmEpDQo+ICAJICovDQo+ICAJdWZzaGNkX3Njc2lf
YmxvY2tfcmVxdWVzdHMoaGJhKTsNCj4gIAlkb3duX3dyaXRlKCZoYmEtPmNsa19zY2FsaW5nX2xv
Y2spOw0KPiAtCWlmICh1ZnNoY2Rfd2FpdF9mb3JfZG9vcmJlbGxfY2xyKGhiYSwgRE9PUkJFTExf
Q0xSX1RPVVRfVVMpKSB7DQo+ICsNCj4gKwlpZiAoIWhiYS0+Y2xrX3NjYWxpbmcuaXNfYWxsb3dl
ZCkNCj4gKwkJcmV0ID0gLUVBR0FJTjsNCj4gKwllbHNlIGlmICh1ZnNoY2Rfd2FpdF9mb3JfZG9v
cmJlbGxfY2xyKGhiYSwgRE9PUkJFTExfQ0xSX1RPVVRfVVMpKQ0KPiAgCQlyZXQgPSAtRUJVU1k7
DQo+ICsNCj4gKwlpZiAocmV0KSB7DQo+ICAJCXVwX3dyaXRlKCZoYmEtPmNsa19zY2FsaW5nX2xv
Y2spOw0KPiAgCQl1ZnNoY2Rfc2NzaV91bmJsb2NrX3JlcXVlc3RzKGhiYSk7DQo+ICsJCWdvdG8g
b3V0Ow0KPiAgCX0NCj4gIA0KPiArCS8qIGxldCdzIG5vdCBnZXQgaW50byBsb3cgcG93ZXIgdW50
aWwgY2xvY2sgc2NhbGluZyBpcyBjb21wbGV0ZWQgKi8NCj4gKwl1ZnNoY2RfaG9sZChoYmEsIGZh
bHNlKTsNCj4gKw0KPiArb3V0Og0KPiAgCXJldHVybiByZXQ7DQo+ICB9DQo+ICANCj4gQEAgLTEx
NjAsNiArMTE3MCw3IEBAIHN0YXRpYyB2b2lkIHVmc2hjZF9jbG9ja19zY2FsaW5nX3VucHJlcGFy
ZShzdHJ1Y3QgdWZzX2hiYSAqaGJhKQ0KPiAgew0KPiAgCXVwX3dyaXRlKCZoYmEtPmNsa19zY2Fs
aW5nX2xvY2spOw0KPiAgCXVmc2hjZF9zY3NpX3VuYmxvY2tfcmVxdWVzdHMoaGJhKTsNCj4gKwl1
ZnNoY2RfcmVsZWFzZShoYmEpOw0KPiAgfQ0KPiAgDQo+ICAvKioNCj4gQEAgLTExNzUsMTIgKzEx
ODYsOSBAQCBzdGF0aWMgaW50IHVmc2hjZF9kZXZmcmVxX3NjYWxlKHN0cnVjdCB1ZnNfaGJhICpo
YmEsIGJvb2wgc2NhbGVfdXApDQo+ICB7DQo+ICAJaW50IHJldCA9IDA7DQo+ICANCj4gLQkvKiBs
ZXQncyBub3QgZ2V0IGludG8gbG93IHBvd2VyIHVudGlsIGNsb2NrIHNjYWxpbmcgaXMgY29tcGxl
dGVkICovDQo+IC0JdWZzaGNkX2hvbGQoaGJhLCBmYWxzZSk7DQo+IC0NCj4gIAlyZXQgPSB1ZnNo
Y2RfY2xvY2tfc2NhbGluZ19wcmVwYXJlKGhiYSk7DQo+ICAJaWYgKHJldCkNCj4gLQkJZ290byBv
dXQ7DQo+ICsJCXJldHVybiByZXQ7DQo+ICANCj4gIAkvKiBzY2FsZSBkb3duIHRoZSBnZWFyIGJl
Zm9yZSBzY2FsaW5nIGRvd24gY2xvY2tzICovDQo+ICAJaWYgKCFzY2FsZV91cCkgew0KPiBAQCAt
MTIxMiw4ICsxMjIwLDYgQEAgc3RhdGljIGludCB1ZnNoY2RfZGV2ZnJlcV9zY2FsZShzdHJ1Y3Qg
dWZzX2hiYSAqaGJhLCBib29sIHNjYWxlX3VwKQ0KPiAgDQo+ICBvdXRfdW5wcmVwYXJlOg0KPiAg
CXVmc2hjZF9jbG9ja19zY2FsaW5nX3VucHJlcGFyZShoYmEpOw0KPiAtb3V0Og0KPiAtCXVmc2hj
ZF9yZWxlYXNlKGhiYSk7DQo+ICAJcmV0dXJuIHJldDsNCj4gIH0NCj4gIA0KPiBAQCAtMTQ4Nyw3
ICsxNDkzLDcgQEAgc3RhdGljIHNzaXplX3QgdWZzaGNkX2Nsa3NjYWxlX2VuYWJsZV9zaG93KHN0
cnVjdCBkZXZpY2UgKmRldiwNCj4gIHsNCj4gIAlzdHJ1Y3QgdWZzX2hiYSAqaGJhID0gZGV2X2dl
dF9kcnZkYXRhKGRldik7DQo+ICANCj4gLQlyZXR1cm4gc25wcmludGYoYnVmLCBQQUdFX1NJWkUs
ICIlZFxuIiwgaGJhLT5jbGtfc2NhbGluZy5pc19hbGxvd2VkKTsNCj4gKwlyZXR1cm4gc25wcmlu
dGYoYnVmLCBQQUdFX1NJWkUsICIlZFxuIiwgaGJhLT5jbGtfc2NhbGluZy5pc19lbmFibGVkKTsN
Cj4gIH0NCj4gIA0KPiAgc3RhdGljIHNzaXplX3QgdWZzaGNkX2Nsa3NjYWxlX2VuYWJsZV9zdG9y
ZShzdHJ1Y3QgZGV2aWNlICpkZXYsDQo+IEBAIC0xNDk2LDEyICsxNTAyLDIwIEBAIHN0YXRpYyBz
c2l6ZV90IHVmc2hjZF9jbGtzY2FsZV9lbmFibGVfc3RvcmUoc3RydWN0IGRldmljZSAqZGV2LA0K
PiAgCXN0cnVjdCB1ZnNfaGJhICpoYmEgPSBkZXZfZ2V0X2RydmRhdGEoZGV2KTsNCj4gIAl1MzIg
dmFsdWU7DQo+ICAJaW50IGVycjsNCj4gKwl1bnNpZ25lZCBsb25nIGZsYWdzOw0KPiArCWJvb2wg
dXBkYXRlID0gdHJ1ZTsNCj4gIA0KPiAgCWlmIChrc3RydG91MzIoYnVmLCAwLCAmdmFsdWUpKQ0K
PiAgCQlyZXR1cm4gLUVJTlZBTDsNCj4gIA0KPiAgCXZhbHVlID0gISF2YWx1ZTsNCj4gLQlpZiAo
dmFsdWUgPT0gaGJhLT5jbGtfc2NhbGluZy5pc19hbGxvd2VkKQ0KPiArCXNwaW5fbG9ja19pcnFz
YXZlKGhiYS0+aG9zdC0+aG9zdF9sb2NrLCBmbGFncyk7DQo+ICsJaWYgKHZhbHVlID09IGhiYS0+
Y2xrX3NjYWxpbmcuaXNfZW5hYmxlZCkNCj4gKwkJdXBkYXRlID0gZmFsc2U7DQo+ICsJZWxzZQ0K
PiArCQloYmEtPmNsa19zY2FsaW5nLmlzX2VuYWJsZWQgPSB2YWx1ZTsNCj4gKwlzcGluX3VubG9j
a19pcnFyZXN0b3JlKGhiYS0+aG9zdC0+aG9zdF9sb2NrLCBmbGFncyk7DQo+ICsJaWYgKCF1cGRh
dGUpDQo+ICAJCWdvdG8gb3V0Ow0KPiAgDQo+ICAJcG1fcnVudGltZV9nZXRfc3luYyhoYmEtPmRl
dik7DQo+IEBAIC0xNTEwLDggKzE1MjQsNiBAQCBzdGF0aWMgc3NpemVfdCB1ZnNoY2RfY2xrc2Nh
bGVfZW5hYmxlX3N0b3JlKHN0cnVjdCBkZXZpY2UgKmRldiwNCj4gIAljYW5jZWxfd29ya19zeW5j
KCZoYmEtPmNsa19zY2FsaW5nLnN1c3BlbmRfd29yayk7DQo+ICAJY2FuY2VsX3dvcmtfc3luYygm
aGJhLT5jbGtfc2NhbGluZy5yZXN1bWVfd29yayk7DQo+ICANCj4gLQloYmEtPmNsa19zY2FsaW5n
LmlzX2FsbG93ZWQgPSB2YWx1ZTsNCj4gLQ0KPiAgCWlmICh2YWx1ZSkgew0KPiAgCQl1ZnNoY2Rf
cmVzdW1lX2Nsa3NjYWxpbmcoaGJhKTsNCj4gIAl9IGVsc2Ugew0KPiBAQCAtMTg0NSw4ICsxODU3
LDYgQEAgc3RhdGljIHZvaWQgdWZzaGNkX2luaXRfY2xrX3NjYWxpbmcoc3RydWN0IHVmc19oYmEg
KmhiYSkNCj4gIAlzbnByaW50Zih3cV9uYW1lLCBzaXplb2Yod3FfbmFtZSksICJ1ZnNfY2xrc2Nh
bGluZ18lZCIsDQo+ICAJCSBoYmEtPmhvc3QtPmhvc3Rfbm8pOw0KPiAgCWhiYS0+Y2xrX3NjYWxp
bmcud29ya3EgPSBjcmVhdGVfc2luZ2xldGhyZWFkX3dvcmtxdWV1ZSh3cV9uYW1lKTsNCj4gLQ0K
PiAtCXVmc2hjZF9jbGtzY2FsaW5nX2luaXRfc3lzZnMoaGJhKTsNCj4gIH0NCj4gIA0KPiAgc3Rh
dGljIHZvaWQgdWZzaGNkX2V4aXRfY2xrX3NjYWxpbmcoc3RydWN0IHVmc19oYmEgKmhiYSkNCj4g
QEAgLTE4NTQsNiArMTg2NCw4IEBAIHN0YXRpYyB2b2lkIHVmc2hjZF9leGl0X2Nsa19zY2FsaW5n
KHN0cnVjdCB1ZnNfaGJhICpoYmEpDQo+ICAJaWYgKCF1ZnNoY2RfaXNfY2xrc2NhbGluZ19zdXBw
b3J0ZWQoaGJhKSkNCj4gIAkJcmV0dXJuOw0KPiAgDQo+ICsJaWYgKGhiYS0+ZGV2ZnJlcSkNCj4g
KwkJZGV2aWNlX3JlbW92ZV9maWxlKGhiYS0+ZGV2LCAmaGJhLT5jbGtfc2NhbGluZy5lbmFibGVf
YXR0cik7DQo+ICAJZGVzdHJveV93b3JrcXVldWUoaGJhLT5jbGtfc2NhbGluZy53b3JrcSk7DQo+
ICAJdWZzaGNkX2RldmZyZXFfcmVtb3ZlKGhiYSk7DQo+ICB9DQo+IEBAIC0xOTE4LDcgKzE5MzAs
NyBAQCBzdGF0aWMgdm9pZCB1ZnNoY2RfY2xrX3NjYWxpbmdfc3RhcnRfYnVzeShzdHJ1Y3QgdWZz
X2hiYSAqaGJhKQ0KPiAgCWlmICghaGJhLT5jbGtfc2NhbGluZy5hY3RpdmVfcmVxcysrKQ0KPiAg
CQlxdWV1ZV9yZXN1bWVfd29yayA9IHRydWU7DQo+ICANCj4gLQlpZiAoIWhiYS0+Y2xrX3NjYWxp
bmcuaXNfYWxsb3dlZCB8fCBoYmEtPnBtX29wX2luX3Byb2dyZXNzKQ0KPiArCWlmICghaGJhLT5j
bGtfc2NhbGluZy5pc19lbmFibGVkIHx8IGhiYS0+cG1fb3BfaW5fcHJvZ3Jlc3MpDQo+ICAJCXJl
dHVybjsNCj4gIA0KPiAgCWlmIChxdWV1ZV9yZXN1bWVfd29yaykNCj4gQEAgLTQ5ODcsNyArNDk5
OSw4IEBAIHN0YXRpYyB2b2lkIF9fdWZzaGNkX3RyYW5zZmVyX3JlcV9jb21wbChzdHJ1Y3QgdWZz
X2hiYSAqaGJhLA0KPiAgCQkJCWNvbXBsZXRlKGhiYS0+ZGV2X2NtZC5jb21wbGV0ZSk7DQo+ICAJ
CQl9DQo+ICAJCX0NCj4gLQkJaWYgKHVmc2hjZF9pc19jbGtzY2FsaW5nX3N1cHBvcnRlZChoYmEp
KQ0KPiArCQlpZiAodWZzaGNkX2lzX2Nsa3NjYWxpbmdfc3VwcG9ydGVkKGhiYSkgJiYNCj4gKwkJ
ICAgIGhiYS0+Y2xrX3NjYWxpbmcuYWN0aXZlX3JlcXMgPiAwKQ0KPiAgCQkJaGJhLT5jbGtfc2Nh
bGluZy5hY3RpdmVfcmVxcy0tOw0KPiAgCX0NCj4gIA0KPiBAQCAtNTY1MCwxOCArNTY2MywyNSBA
QCBzdGF0aWMgdm9pZCB1ZnNoY2RfZXJyX2hhbmRsaW5nX3ByZXBhcmUoc3RydWN0IHVmc19oYmEg
KmhiYSkNCj4gIAkJdWZzaGNkX3ZvcHNfcmVzdW1lKGhiYSwgVUZTX1JVTlRJTUVfUE0pOw0KPiAg
CX0gZWxzZSB7DQo+ICAJCXVmc2hjZF9ob2xkKGhiYSwgZmFsc2UpOw0KPiAtCQlpZiAoaGJhLT5j
bGtfc2NhbGluZy5pc19hbGxvd2VkKSB7DQo+ICsJCWlmIChoYmEtPmNsa19zY2FsaW5nLmlzX2Vu
YWJsZWQpIHsNCj4gIAkJCWNhbmNlbF93b3JrX3N5bmMoJmhiYS0+Y2xrX3NjYWxpbmcuc3VzcGVu
ZF93b3JrKTsNCj4gIAkJCWNhbmNlbF93b3JrX3N5bmMoJmhiYS0+Y2xrX3NjYWxpbmcucmVzdW1l
X3dvcmspOw0KPiAgCQkJdWZzaGNkX3N1c3BlbmRfY2xrc2NhbGluZyhoYmEpOw0KPiAgCQl9DQo+
ICAJfQ0KPiArCWRvd25fd3JpdGUoJmhiYS0+Y2xrX3NjYWxpbmdfbG9jayk7DQo+ICsJaGJhLT5j
bGtfc2NhbGluZy5pc19hbGxvd2VkID0gZmFsc2U7DQo+ICsJdXBfd3JpdGUoJmhiYS0+Y2xrX3Nj
YWxpbmdfbG9jayk7DQo+ICB9DQo+ICANCj4gIHN0YXRpYyB2b2lkIHVmc2hjZF9lcnJfaGFuZGxp
bmdfdW5wcmVwYXJlKHN0cnVjdCB1ZnNfaGJhICpoYmEpDQo+ICB7DQo+ICAJdWZzaGNkX3JlbGVh
c2UoaGJhKTsNCj4gLQlpZiAoaGJhLT5jbGtfc2NhbGluZy5pc19hbGxvd2VkKQ0KPiArDQo+ICsJ
ZG93bl93cml0ZSgmaGJhLT5jbGtfc2NhbGluZ19sb2NrKTsNCj4gKwloYmEtPmNsa19zY2FsaW5n
LmlzX2FsbG93ZWQgPSB0cnVlOw0KPiArCXVwX3dyaXRlKCZoYmEtPmNsa19zY2FsaW5nX2xvY2sp
Ow0KPiArCWlmIChoYmEtPmNsa19zY2FsaW5nLmlzX2VuYWJsZWQpDQo+ICAJCXVmc2hjZF9yZXN1
bWVfY2xrc2NhbGluZyhoYmEpOw0KPiAgCXBtX3J1bnRpbWVfcHV0KGhiYS0+ZGV2KTsNCj4gIH0N
Cj4gQEAgLTc2MjAsMTIgKzc2NDAsMTQgQEAgc3RhdGljIGludCB1ZnNoY2RfYWRkX2x1cyhzdHJ1
Y3QgdWZzX2hiYSAqaGJhKQ0KPiAgCQkJc2l6ZW9mKHN0cnVjdCB1ZnNfcGFfbGF5ZXJfYXR0cikp
Ow0KPiAgCQloYmEtPmNsa19zY2FsaW5nLnNhdmVkX3B3cl9pbmZvLmlzX3ZhbGlkID0gdHJ1ZTsN
Cj4gIAkJaWYgKCFoYmEtPmRldmZyZXEpIHsNCj4gKwkJCWhiYS0+Y2xrX3NjYWxpbmcuaXNfYWxs
b3dlZCA9IHRydWU7DQoNClBlcmhhcHMgbW92aW5nIHRoaXMgbGluZSBhZnRlciB1ZnNoY2RfZGV2
ZnJlcV9pbml0KCkgaXMgc3VjY2Vzc2Z1bD8NCg0KPiAgCQkJcmV0ID0gdWZzaGNkX2RldmZyZXFf
aW5pdChoYmEpOw0KPiAgCQkJaWYgKHJldCkNCj4gIAkJCQlnb3RvIG91dDsNCj4gLQkJfQ0KPiAg
DQo+IC0JCWhiYS0+Y2xrX3NjYWxpbmcuaXNfYWxsb3dlZCA9IHRydWU7DQo+ICsJCQloYmEtPmNs
a19zY2FsaW5nLmlzX2VuYWJsZWQgPSB0cnVlOw0KPiArCQkJdWZzaGNkX2Nsa3NjYWxpbmdfaW5p
dF9zeXNmcyhoYmEpOw0KPiArCQl9DQo+ICAJfQ0KPiAgDQo+ICAJdWZzX2JzZ19wcm9iZShoYmEp
Ow0KPiBAQCAtODQ5MSwxMSArODUxMywxNCBAQCBzdGF0aWMgaW50IHVmc2hjZF9zdXNwZW5kKHN0
cnVjdCB1ZnNfaGJhICpoYmEsIGVudW0gdWZzX3BtX29wIHBtX29wKQ0KPiAgCXVmc2hjZF9ob2xk
KGhiYSwgZmFsc2UpOw0KPiAgCWhiYS0+Y2xrX2dhdGluZy5pc19zdXNwZW5kZWQgPSB0cnVlOw0K
PiAgDQo+IC0JaWYgKGhiYS0+Y2xrX3NjYWxpbmcuaXNfYWxsb3dlZCkgew0KPiArCWlmIChoYmEt
PmNsa19zY2FsaW5nLmlzX2VuYWJsZWQpIHsNCj4gIAkJY2FuY2VsX3dvcmtfc3luYygmaGJhLT5j
bGtfc2NhbGluZy5zdXNwZW5kX3dvcmspOw0KPiAgCQljYW5jZWxfd29ya19zeW5jKCZoYmEtPmNs
a19zY2FsaW5nLnJlc3VtZV93b3JrKTsNCj4gIAkJdWZzaGNkX3N1c3BlbmRfY2xrc2NhbGluZyho
YmEpOw0KPiAgCX0NCj4gKwlkb3duX3dyaXRlKCZoYmEtPmNsa19zY2FsaW5nX2xvY2spOw0KPiAr
CWhiYS0+Y2xrX3NjYWxpbmcuaXNfYWxsb3dlZCA9IGZhbHNlOw0KPiArCXVwX3dyaXRlKCZoYmEt
PmNsa19zY2FsaW5nX2xvY2spOw0KPiAgDQo+ICAJaWYgKHJlcV9kZXZfcHdyX21vZGUgPT0gVUZT
X0FDVElWRV9QV1JfTU9ERSAmJg0KPiAgCQkJcmVxX2xpbmtfc3RhdGUgPT0gVUlDX0xJTktfQUNU
SVZFX1NUQVRFKSB7DQo+IEBAIC04NTkyLDggKzg2MTcsNiBAQCBzdGF0aWMgaW50IHVmc2hjZF9z
dXNwZW5kKHN0cnVjdCB1ZnNfaGJhICpoYmEsIGVudW0gdWZzX3BtX29wIHBtX29wKQ0KPiAgCWdv
dG8gb3V0Ow0KPiAgDQo+ICBzZXRfbGlua19hY3RpdmU6DQo+IC0JaWYgKGhiYS0+Y2xrX3NjYWxp
bmcuaXNfYWxsb3dlZCkNCj4gLQkJdWZzaGNkX3Jlc3VtZV9jbGtzY2FsaW5nKGhiYSk7DQo+ICAJ
dWZzaGNkX3ZyZWdfc2V0X2hwbShoYmEpOw0KPiAgCWlmICh1ZnNoY2RfaXNfbGlua19oaWJlcm44
KGhiYSkgJiYgIXVmc2hjZF91aWNfaGliZXJuOF9leGl0KGhiYSkpDQo+ICAJCXVmc2hjZF9zZXRf
bGlua19hY3RpdmUoaGJhKTsNCj4gQEAgLTg2MDMsNyArODYyNiwxMCBAQCBzdGF0aWMgaW50IHVm
c2hjZF9zdXNwZW5kKHN0cnVjdCB1ZnNfaGJhICpoYmEsIGVudW0gdWZzX3BtX29wIHBtX29wKQ0K
PiAgCWlmICghdWZzaGNkX3NldF9kZXZfcHdyX21vZGUoaGJhLCBVRlNfQUNUSVZFX1BXUl9NT0RF
KSkNCj4gIAkJdWZzaGNkX2Rpc2FibGVfYXV0b19ia29wcyhoYmEpOw0KPiAgZW5hYmxlX2dhdGlu
ZzoNCj4gLQlpZiAoaGJhLT5jbGtfc2NhbGluZy5pc19hbGxvd2VkKQ0KPiArCWRvd25fd3JpdGUo
JmhiYS0+Y2xrX3NjYWxpbmdfbG9jayk7DQo+ICsJaGJhLT5jbGtfc2NhbGluZy5pc19hbGxvd2Vk
ID0gdHJ1ZTsNCj4gKwl1cF93cml0ZSgmaGJhLT5jbGtfc2NhbGluZ19sb2NrKTsNCj4gKwlpZiAo
aGJhLT5jbGtfc2NhbGluZy5pc19lbmFibGVkKQ0KPiAgCQl1ZnNoY2RfcmVzdW1lX2Nsa3NjYWxp
bmcoaGJhKTsNCj4gIAloYmEtPmNsa19nYXRpbmcuaXNfc3VzcGVuZGVkID0gZmFsc2U7DQo+ICAJ
aGJhLT5kZXZfaW5mby5iX3JwbV9kZXZfZmx1c2hfY2FwYWJsZSA9IGZhbHNlOw0KPiBAQCAtODcw
MSw3ICs4NzI3LDEwIEBAIHN0YXRpYyBpbnQgdWZzaGNkX3Jlc3VtZShzdHJ1Y3QgdWZzX2hiYSAq
aGJhLCBlbnVtIHVmc19wbV9vcCBwbV9vcCkNCj4gIA0KPiAgCWhiYS0+Y2xrX2dhdGluZy5pc19z
dXNwZW5kZWQgPSBmYWxzZTsNCj4gIA0KPiAtCWlmIChoYmEtPmNsa19zY2FsaW5nLmlzX2FsbG93
ZWQpDQo+ICsJZG93bl93cml0ZSgmaGJhLT5jbGtfc2NhbGluZ19sb2NrKTsNCj4gKwloYmEtPmNs
a19zY2FsaW5nLmlzX2FsbG93ZWQgPSB0cnVlOw0KPiArCXVwX3dyaXRlKCZoYmEtPmNsa19zY2Fs
aW5nX2xvY2spOw0KPiArCWlmIChoYmEtPmNsa19zY2FsaW5nLmlzX2VuYWJsZWQpDQo+ICAJCXVm
c2hjZF9yZXN1bWVfY2xrc2NhbGluZyhoYmEpOw0KPiAgDQo+ICAJLyogRW5hYmxlIEF1dG8tSGli
ZXJuYXRlIGlmIGNvbmZpZ3VyZWQgKi8NCj4gQEAgLTg3MjUsOCArODc1NCw2IEBAIHN0YXRpYyBp
bnQgdWZzaGNkX3Jlc3VtZShzdHJ1Y3QgdWZzX2hiYSAqaGJhLCBlbnVtIHVmc19wbV9vcCBwbV9v
cCkNCj4gIAl1ZnNoY2RfdnJlZ19zZXRfbHBtKGhiYSk7DQo+ICBkaXNhYmxlX2lycV9hbmRfdm9w
c19jbGtzOg0KPiAgCXVmc2hjZF9kaXNhYmxlX2lycShoYmEpOw0KPiAtCWlmIChoYmEtPmNsa19z
Y2FsaW5nLmlzX2FsbG93ZWQpDQo+IC0JCXVmc2hjZF9zdXNwZW5kX2Nsa3NjYWxpbmcoaGJhKTsN
Cj4gIAl1ZnNoY2Rfc2V0dXBfY2xvY2tzKGhiYSwgZmFsc2UpOw0KPiAgCWlmICh1ZnNoY2RfaXNf
Y2xrZ2F0aW5nX2FsbG93ZWQoaGJhKSkgew0KPiAgCQloYmEtPmNsa19nYXRpbmcuc3RhdGUgPSBD
TEtTX09GRjsNCj4gQEAgLTg5MTUsNiArODk0Miw4IEBAIGludCB1ZnNoY2Rfc2h1dGRvd24oc3Ry
dWN0IHVmc19oYmEgKmhiYSkNCj4gIA0KPiAgCXBtX3J1bnRpbWVfZ2V0X3N5bmMoaGJhLT5kZXYp
Ow0KPiAgDQo+ICsJdWZzaGNkX2V4aXRfY2xrX3NjYWxpbmcoaGJhKTsNCj4gKw0KPiAgCXJldCA9
IHVmc2hjZF9zdXNwZW5kKGhiYSwgVUZTX1NIVVRET1dOX1BNKTsNCj4gIG91dDoNCj4gIAlpZiAo
cmV0KQ0KPiBAQCAtODk0NCw4ICs4OTczLDYgQEAgdm9pZCB1ZnNoY2RfcmVtb3ZlKHN0cnVjdCB1
ZnNfaGJhICpoYmEpDQo+ICANCj4gIAl1ZnNoY2RfZXhpdF9jbGtfc2NhbGluZyhoYmEpOw0KPiAg
CXVmc2hjZF9leGl0X2Nsa19nYXRpbmcoaGJhKTsNCj4gLQlpZiAodWZzaGNkX2lzX2Nsa3NjYWxp
bmdfc3VwcG9ydGVkKGhiYSkpDQo+IC0JCWRldmljZV9yZW1vdmVfZmlsZShoYmEtPmRldiwgJmhi
YS0+Y2xrX3NjYWxpbmcuZW5hYmxlX2F0dHIpOw0KPiAgCXVmc2hjZF9oYmFfZXhpdChoYmEpOw0K
PiAgfQ0KPiAgRVhQT1JUX1NZTUJPTF9HUEwodWZzaGNkX3JlbW92ZSk7DQo+IGRpZmYgLS1naXQg
YS9kcml2ZXJzL3Njc2kvdWZzL3Vmc2hjZC5oIGIvZHJpdmVycy9zY3NpL3Vmcy91ZnNoY2QuaA0K
PiBpbmRleCBlMGYwMGE0Li45ZmNlY2JhIDEwMDY0NA0KPiAtLS0gYS9kcml2ZXJzL3Njc2kvdWZz
L3Vmc2hjZC5oDQo+ICsrKyBiL2RyaXZlcnMvc2NzaS91ZnMvdWZzaGNkLmgNCj4gQEAgLTM4Miw2
ICszODIsNyBAQCBzdHJ1Y3QgdWZzX3NhdmVkX3B3cl9pbmZvIHsNCj4gICAqIEB3b3JrcTogd29y
a3F1ZXVlIHRvIHNjaGVkdWxlIGRldmZyZXEgc3VzcGVuZC9yZXN1bWUgd29yaw0KPiAgICogQHN1
c3BlbmRfd29yazogd29ya2VyIHRvIHN1c3BlbmQgZGV2ZnJlcQ0KPiAgICogQHJlc3VtZV93b3Jr
OiB3b3JrZXIgdG8gcmVzdW1lIGRldmZyZXENCj4gKyAqIEBpc19lbmFibGVkOiB0cmFja3MgaWYg
c2NhbGluZyBpcyBjdXJyZW50bHkgZW5hYmxlZCBvciBub3QNCj4gICAqIEBpc19hbGxvd2VkOiB0
cmFja3MgaWYgc2NhbGluZyBpcyBjdXJyZW50bHkgYWxsb3dlZCBvciBub3QNCj4gICAqIEBpc19i
dXN5X3N0YXJ0ZWQ6IHRyYWNrcyBpZiBidXN5IHBlcmlvZCBoYXMgc3RhcnRlZCBvciBub3QNCj4g
ICAqIEBpc19zdXNwZW5kZWQ6IHRyYWNrcyBpZiBkZXZmcmVxIGlzIHN1c3BlbmRlZCBvciBub3QN
Cj4gQEAgLTM5Niw2ICszOTcsNyBAQCBzdHJ1Y3QgdWZzX2Nsa19zY2FsaW5nIHsNCj4gIAlzdHJ1
Y3Qgd29ya3F1ZXVlX3N0cnVjdCAqd29ya3E7DQo+ICAJc3RydWN0IHdvcmtfc3RydWN0IHN1c3Bl
bmRfd29yazsNCj4gIAlzdHJ1Y3Qgd29ya19zdHJ1Y3QgcmVzdW1lX3dvcms7DQo+ICsJYm9vbCBp
c19lbmFibGVkOw0KPiAgCWJvb2wgaXNfYWxsb3dlZDsNCj4gIAlib29sIGlzX2J1c3lfc3RhcnRl
ZDsNCj4gIAlib29sIGlzX3N1c3BlbmRlZDsNCg0KTm93IHRoZXJlIGFyZSBtb3JlIGFuZCBtb3Jl
ICJzaW1pbGFyIGJvb2xlYW4gYXR0cmlidXRlcyIgcmVnYXJkaW5nDQpjbGstc2NhbGluZyBjb250
cm9sLCBtYXliZSBhZGQgbW9yZSBjb21wcmVoZW5zaXZlIGNvbW1lbnRzIHRvIGRlc2NyaWJlDQp0
aGVtPw0KDQpPdGhlcndpc2UgdGhpcyBwYXRjaCBsb29rcyBnb29kIHRvIG1lLg0KDQpGZWVsIGZy
ZWUgdG8gYWRkDQpSZXZpZXdlZC1ieTogU3RhbmxleSBDaHUgPHN0YW5sZXkuY2h1QG1lZGlhdGVr
LmNvbT4NCg0KDQoNCg==

